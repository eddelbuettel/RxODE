<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • RxODE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="">
<meta property="og:description" content="RxODE">
<meta property="og:image" content="https://nlmixrdevelopment.github.io/RxODE/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RxODE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Getting started</li>
    <li>
      <a href="../articles/RxODE-intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/RxODE-syntax.html">RxODE mini language syntax</a>
    </li>
    <li>
      <a href="../articles/RxODE-pipeline.html">RxODE with piping ie %&gt;%</a>
    </li>
    <li>
      <a href="../articles/RxODE-speed.html">Speeding up RxODE ODE solving</a>
    </li>
    <li>
      <a href="../articles/RxODE-data-frame.html">Adaptive Data Frames with RxODE</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced Features, Model Types, Technical Details</li>
    <li>
      <a href="../articles/RxODE-model-types.html">RxODE model types</a>
    </li>
    <li>
      <a href="../articles/RxODE-cmt.html">Chainging RxODE compartment numbers</a>
    </li>
    <li>
      <a href="../articles/RxODE-transit-compartments.html">RxODE transit compartment models</a>
    </li>
    <li>
      <a href="../articles/RxODE-shiny.html">Using Shiny with RxODE</a>
    </li>
    <li>
      <a href="../articles/RxODE-covariates.html">RxODE covariates</a>
    </li>
    <li>
      <a href="../articles/RxODE-stiff.html">Stiff Systems and Jacobian specification</a>
    </li>
    <li>
      <a href="../articles/RxODE-rxUse.html">Adding compiled RxODE models to your package</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-stethoscope"></span>
     
    Dosing/Events
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/RxODE-datasets.html">nlmixr/RxODE dataset overview</a>
    </li>
    <li>
      <a href="../articles/RxODE-event-types.html">Supported Event Types</a>
    </li>
    <li>
      <a href="../articles/RxODE-event-table.html">Easy RxODE Event Tables</a>
    </li>
    <li>
      <a href="../articles/RxODE-events-classic.html">Classic RxODE events explained</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Simulations
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rxode-single-subject.html">Single Subject ODE solving</a>
    </li>
    <li>
      <a href="../articles/RxODE-sim-var.html">Multiple Subject RxODE Simulation</a>
    </li>
    <li>
      <a href="../articles/RxODE-prior-data.html">Using Prior Data for ODE solving</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-life-ring"></span>
     
    Help
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/RxODE-tutorials.html">Running the interactive tutorials</a>
    </li>
    <li>
      <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4728294/pdf/PSP4-5-03.pdf" class="external-link">2015 CPT tutorial</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/RxODE-covariates.html">Adding Circadian Rythmn (time-varying covariates)</a>
    </li>
    <li>
      <a href="../articles/RxODE-wt.html">Weight Based Dosing</a>
    </li>
    <li>
      <a href="../articles/RxODE-nesting.html">Simulating Multiple levels of nesting (iov, between study etc)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://nlmixrdevelopment.github.io/RxODE/reference/index.html">
    <span class="fas fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-archive"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://nlmixrdevelopment.github.io/RxODE-manual/">RxODE User Guide</a>
    </li>
    <li>
      <a href="https://nlmixrdevelopment.github.io/nlmixr/" class="external-link">nlmixr</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/RxODE" class="external-link">
    <span class="fas fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/nlmixrdevelopment/RxODE/releases" class="external-link">
    <span class="fas fa-download"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sim-var_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nlmixrdevelopment/RxODE/blob/master/vignettes/sim-var.Rmd" class="external-link"><code>vignettes/sim-var.Rmd</code></a></small>
      <div class="hidden name"><code>sim-var.Rmd</code></div>

    </div>

    
    
<div id="population-simulations-with-rxode" class="section level1">
<h1 class="hasAnchor">
<a href="#population-simulations-with-rxode" class="anchor"></a>Population Simulations with RxODE</h1>
<div id="simulation-of-variability-with-rxode" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-of-variability-with-rxode" class="anchor"></a>Simulation of Variability with RxODE</h2>
<p>In pharmacometrics the nonlinear-mixed effect modeling software (like nlmixr) characterizes the between-subject variability. With this between subject variability you can simulate new subjects.</p>
<p>Assuming that you have a 2-compartment, indirect response model, you can set create an RxODE model describing this system below:</p>
<div id="setting-up-the-rxode-model" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-the-rxode-model" class="anchor"></a>Setting up the RxODE model</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nlmixrdevelopment.github.io/RxODE/">RxODE</a></span><span class="op">)</span></code></pre></div>
<pre><code>## RxODE 1.0.5 using 1 threads (see ?getRxThreads)
##   no cache: create with `rxCreateCache()`</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RxODE.html">RxODE</a></span><span class="op">(</span><span class="op">{</span>
  <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">C2</span> <span class="op">=</span> <span class="va">centr</span><span class="op">/</span><span class="va">V2</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">prop.err</span><span class="op">)</span>;
  <span class="va">C3</span> <span class="op">=</span> <span class="va">peri</span><span class="op">/</span><span class="va">V3</span>;
  <span class="va">CL</span> <span class="op">=</span>  <span class="va">TCl</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.Cl</span><span class="op">)</span> <span class="co">## This is coded as a variable in the model</span>
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">=</span><span class="op">-</span><span class="va">KA</span><span class="op">*</span><span class="va">depot</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">=</span> <span class="va">KA</span><span class="op">*</span><span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span>  <span class="op">=</span>                    <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span>  <span class="op">=</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">C2</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span><span class="op">+</span><span class="va">C2</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">eff</span>;
<span class="op">}</span><span class="op">)</span></code></pre></div>
<pre><code>## qs v0.23.6.</code></pre>
</div>
<div id="adding-the-parameter-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-the-parameter-estimates" class="anchor"></a>Adding the parameter estimates</h3>
<p>The next step is to get the parameters into R so that you can start the simulation:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA<span class="op">=</span><span class="fl">2.94E-01</span>, TCl<span class="op">=</span><span class="fl">1.86E+01</span>, V2<span class="op">=</span><span class="fl">4.02E+01</span>,  <span class="co"># central </span>
           Q<span class="op">=</span><span class="fl">1.05E+01</span>, V3<span class="op">=</span><span class="fl">2.97E+02</span>,                <span class="co"># peripheral</span>
           Kin<span class="op">=</span><span class="fl">1</span>, Kout<span class="op">=</span><span class="fl">1</span>, EC50<span class="op">=</span><span class="fl">200</span>, prop.err<span class="op">=</span><span class="fl">0</span><span class="op">)</span>      <span class="co"># effects</span></code></pre></div>
<p>In this case, I use <code>lotri</code> to specify the omega since it uses similar lower-triangular matrix specification as nlmixr (also similar to NONMEM):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## the column names of the omega matrix need to match the parameters specified by RxODE</span>
<span class="va">omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri</a></span><span class="op">(</span><span class="va">eta.Cl</span> <span class="op">~</span> <span class="fl">0.4</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">omega</span></code></pre></div>
<pre><code>##        eta.Cl
## eta.Cl   0.16</code></pre>
</div>
<div id="simulating" class="section level3">
<h3 class="hasAnchor">
<a href="#simulating" class="anchor"></a>Simulating</h3>
<p>The next step to simulate is to create the dosing regimen for overall simulation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">10000</span>, cmt<span class="op">=</span><span class="st">"centr"</span><span class="op">)</span></code></pre></div>
<p>If you wish, you can also add sampling times (though now RxODE can fill these in for you):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ev</span> <span class="op">&lt;-</span> <span class="va">ev</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>, length.out<span class="op">=</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>Note the <code>et</code> takes similar arguments as <code>seq</code> when adding sampling times. There are more methods to adding sampling times and events to make complex dosing regimens (See <a href="RxODE-events.html">the event vignette</a>). This includes ways to add variability to the <a href="RxODE-events.html#add-doses-and-samples-within-a-sampling-window">both the sampling and dosing times</a>).</p>
<p>Once this is complete you can simulate using the <code>rxSolve</code> routine:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>,<span class="va">theta</span>,<span class="va">ev</span>,omega<span class="op">=</span><span class="va">omega</span>,nSub<span class="op">=</span><span class="fl">100</span><span class="op">)</span></code></pre></div>
<p>To quickly look and customize your simulation you use the default <code>plot</code> routine. Since this is an RxODE object, it will create a <code>ggplot2</code> object that you can modify as you wish. The extra parameter to the <code>plot</code> tells <code>RxODE</code>/<code>R</code> what piece of information you are interested in plotting. In this case, we are interested in looking at the derived parameter <code>C2</code>:</p>
</div>
<div id="checking-the-simulation-with-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#checking-the-simulation-with-plot" class="anchor"></a>Checking the simulation with <code>plot</code>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="co">## The plots from RxODE are ggplots so they can be modified with</span>
<span class="co">## standard ggplot commands.</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Central Compartment"</span><span class="op">)</span> </code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Of course this additional parameter could also be a state value, like <code>eff</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## They also takes many of the standard plot arguments; See ?plot</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">eff</span>, ylab<span class="op">=</span><span class="st">"Effect"</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Or you could even look at the two side-by-side:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, <span class="va">eff</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Or stack them with <code>patchwork</code></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">C2</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span>, <span class="va">eff</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="processing-the-data-to-create-summary-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#processing-the-data-to-create-summary-plots" class="anchor"></a>Processing the data to create summary plots</h3>
<p>Usually in pharmacometric simulations it is not enough to simply simulate the system. We have to do something easier to digest, like look at the central and extreme tendencies of the simulation.</p>
<p>Since the <code>RxODE</code> solve object is a type of <a href="RxODE-data-frame.html">data frame</a></p>
<p>It is now straightforward to perform calculations and generate plots with the simulated data. You can</p>
<p>Below, the 5th, 50th, and 95th percentiles of the simulated data are plotted.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"C2"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"Central Concentration"</span>, log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></code></pre></div>
<pre><code>## ! in order to put confidence bands around the intervals, you need at least 2500 simulations</code></pre>
<pre><code>## summarizing data...done</code></pre>
<p><img src="sim-var_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="st">"eff"</span>, level<span class="op">=</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>ylab<span class="op">=</span><span class="st">"Effect"</span><span class="op">)</span></code></pre></div>
<pre><code>## ! in order to put confidence bands around the intervals, you need at least 2500 simulations</code></pre>
<pre><code>## summarizing data...done</code></pre>
<p><img src="sim-var_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Note that you can see the parameters that were simulated for the example</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">param</span><span class="op">)</span></code></pre></div>
<pre><code>##   sim.id   V2 prop.err  V3  TCl     eta.Cl    KA    Q Kin Kout EC50
## 1      1 40.2        0 297 18.6  0.2368417 0.294 10.5   1    1  200
## 2      2 40.2        0 297 18.6  0.5454099 0.294 10.5   1    1  200
## 3      3 40.2        0 297 18.6  0.1828379 0.294 10.5   1    1  200
## 4      4 40.2        0 297 18.6 -0.2237885 0.294 10.5   1    1  200
## 5      5 40.2        0 297 18.6  0.4640872 0.294 10.5   1    1  200
## 6      6 40.2        0 297 18.6 -0.2748536 0.294 10.5   1    1  200</code></pre>
</div>
<div id="simulation-of-unexplained-variability-sigma" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation-of-unexplained-variability-sigma" class="anchor"></a>Simulation of unexplained variability (sigma)</h3>
<p>In addition to conveniently simulating between subject variability, you can also easily simulate unexplained variability.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RxODE.html">RxODE</a></span><span class="op">(</span><span class="op">{</span>
  <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">C2</span> <span class="op">=</span> <span class="va">centr</span><span class="op">/</span><span class="va">V2</span>;
  <span class="va">C3</span> <span class="op">=</span> <span class="va">peri</span><span class="op">/</span><span class="va">V3</span>;
  <span class="va">CL</span> <span class="op">=</span>  <span class="va">TCl</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.Cl</span><span class="op">)</span> <span class="co">## This is coded as a variable in the model</span>
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">=</span><span class="op">-</span><span class="va">KA</span><span class="op">*</span><span class="va">depot</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">=</span> <span class="va">KA</span><span class="op">*</span><span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span>  <span class="op">=</span>                    <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span>  <span class="op">=</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">C2</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span><span class="op">+</span><span class="va">C2</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">eff</span>;
  <span class="va">e</span> <span class="op">=</span> <span class="va">eff</span><span class="op">+</span><span class="va">eff.err</span>
  <span class="va">cp</span> <span class="op">=</span> <span class="va">centr</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">cp.err</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA<span class="op">=</span><span class="fl">2.94E-01</span>, TCl<span class="op">=</span><span class="fl">1.86E+01</span>, V2<span class="op">=</span><span class="fl">4.02E+01</span>,  <span class="co"># central </span>
           Q<span class="op">=</span><span class="fl">1.05E+01</span>, V3<span class="op">=</span><span class="fl">2.97E+02</span>,                <span class="co"># peripheral</span>
           Kin<span class="op">=</span><span class="fl">1</span>, Kout<span class="op">=</span><span class="fl">1</span>, EC50<span class="op">=</span><span class="fl">200</span><span class="op">)</span>                <span class="co"># effects  </span>

<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri</a></span><span class="op">(</span><span class="va">eff.err</span> <span class="op">~</span> <span class="fl">0.1</span>, <span class="va">cp.err</span> <span class="op">~</span> <span class="fl">0.1</span><span class="op">)</span>


<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">theta</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span>, nSub<span class="op">=</span><span class="fl">100</span>, sigma<span class="op">=</span><span class="va">sigma</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">sim</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eff"</span>, <span class="st">"centr"</span><span class="op">)</span><span class="op">)</span>;</code></pre></div>
<pre><code>## ! in order to put confidence bands around the intervals, you need at least 2500 simulations</code></pre>
<pre><code>## summarizing data...done</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="simulation-of-individuals" class="section level3">
<h3 class="hasAnchor">
<a href="#simulation-of-individuals" class="anchor"></a>Simulation of Individuals</h3>
<p>Sometimes you may want to match the dosing and observations of individuals in a clinical trial. To do this you will have to create a data.frame using the <code>RxODE</code> event specification as well as an <code>ID</code> column to indicate an individual. The RxODE event vignette talks more about how these datasets should be created.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eventTable.html">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/add.dosing.html">add.dosing</a></span><span class="op">(</span>dose<span class="op">=</span><span class="fl">10000</span>, nbr.doses<span class="op">=</span><span class="fl">1</span>, dosing.to<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/add.sampling.html">add.sampling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>,length.out<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>;

<span class="va">ev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eventTable.html">eventTable</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/add.dosing.html">add.dosing</a></span><span class="op">(</span>dose<span class="op">=</span><span class="fl">5000</span>, nbr.doses<span class="op">=</span><span class="fl">1</span>, dosing.to<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/add.sampling.html">add.sampling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">48</span>,length.out<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span>;

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fl">1</span>, <span class="va">ev1</span><span class="op">$</span><span class="fu">get.EventTable</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>,
             <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fl">2</span>, <span class="va">ev2</span><span class="op">$</span><span class="fu">get.EventTable</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>


<span class="co">## Note the number of subject is not needed since it is determined by the data</span>
<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">theta</span>, <span class="va">dat</span>, omega<span class="op">=</span><span class="va">omega</span>, sigma<span class="op">=</span><span class="va">sigma</span><span class="op">)</span>

<span class="va">sim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">time</span>, <span class="va">e</span>, <span class="va">cp</span><span class="op">)</span></code></pre></div>
<pre><code>##    id          time         e          cp
## 1   1  0.000000 [h] 1.0563542 11329.59098
## 2   1  5.333333 [h] 1.4003578   376.07820
## 3   1 10.666667 [h] 0.0510544   117.09167
## 4   1 16.000000 [h] 1.4589483   141.30089
## 5   1 21.333333 [h] 1.1416624    84.85403
## 6   1 26.666667 [h] 1.2504412    95.93320
## 7   1 32.000000 [h] 0.9425509   144.84771
## 8   1 37.333333 [h] 1.5173332   148.73731
## 9   1 42.666667 [h] 1.2391798    60.69626
## 10  1 48.000000 [h] 1.3173971    53.60546
## 11  2  0.000000 [h] 0.7351683  5471.03043
## 12  2  6.857143 [h] 0.7138482   109.19130
## 13  2 13.714286 [h] 1.2041123   137.81498
## 14  2 20.571429 [h] 1.1766657    81.08167
## 15  2 27.428571 [h] 1.7274978    57.74205
## 16  2 34.285714 [h] 0.4546936    60.74535
## 17  2 41.142857 [h] 0.7159257    44.59950
## 18  2 48.000000 [h] 1.3206859    42.03860</code></pre>
</div>
</div>
</div>
<div id="simulation-of-clinical-trials" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation-of-clinical-trials" class="anchor"></a>Simulation of Clinical Trials</h1>
<p>By either using a simple single event table, or data from a clinical trial as described above, a complete clinical trial simulation can be performed.</p>
<p>Typically in clinical trial simulations you want to account for the uncertainty in the fixed parameter estimates, and even the uncertainty in both your between subject variability as well as the unexplained variability.</p>
<p><code>RxODE</code> allows you to account for these uncertainties by simulating multiple virtual “studies,” specified by the parameter <code>nStud</code>. Each of these studies samples a realization of fixed effect parameters and covariance matrices for the between subject variability(<code>omega</code>) and unexplained variabilities (<code>sigma</code>). Depending on the information you have from the models, there are a few strategies for simulating a realization of the <code>omega</code> and <code>sigma</code> matrices.</p>
<p>The first strategy occurs when either there is not any standard errors for standard deviations (or related parameters), or there is a modeled correlation in the model you are simulating from. In that case the suggested strategy is to use the inverse Wishart (parameterized to scale to the conjugate prior)/<a href="https://en.wikipedia.org/wiki/Scaled_inverse_chi-squared_distribution" class="external-link">scaled inverse chi distribution</a>. this approach uses a single parameter to inform the variability of the covariance matrix sampled (the degrees of freedom).</p>
<p>The second strategy occurs if you have standard errors on the variance/standard deviation with no modeled correlations in the covariance matrix. In this approach you perform separate simulations for the standard deviations and the correlation matrix. First you simulate the variance/standard deviation components in the <code>thetaMat</code> multivariate normal simulation. After simulation and transformation to standard deviations, a correlation matrix is simulated using the degrees of freedom of your covariance matrix. Combining the simulated standard deviation with the simulated correlation matrix will give a simulated covariance matrix. For smaller dimension covariance matrices (dimension &lt; 10x10) it is recommended you use the <code>lkj</code> distribution to simulate the correlation matrix. For higher dimension covariance matrices it is suggested you use the inverse wishart distribution (transformed to a correlation matrix) for the simulations.</p>
<p>The covariance/variance prior is simulated from <code>RxODE</code>s <code><a href="../reference/cvPost.html">cvPost()</a></code> function.</p>
<div id="simulation-from-inverse-wishart-correlations" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-from-inverse-wishart-correlations" class="anchor"></a>Simulation from inverse Wishart correlations</h2>
<p>An example of this simulation is below:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Creating covariance matrix</span>
<span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">8</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span>
<span class="va">tMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">tcrossprod</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="va">tmp</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">8</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">tMat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>

<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">theta</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span>, nSub<span class="op">=</span><span class="fl">100</span>, sigma<span class="op">=</span><span class="va">sigma</span>, thetaMat<span class="op">=</span><span class="va">tMat</span>, nStud<span class="op">=</span><span class="fl">10</span>,
                dfSub<span class="op">=</span><span class="fl">10</span>, dfObs<span class="op">=</span><span class="fl">100</span><span class="op">)</span>

<span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centr"</span>, <span class="st">"eff"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarizing data...done</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>If you wish you can see what <code>omega</code> and <code>sigma</code> was used for each virtual study by accessing them in the solved data object with <code>$omega.list</code> and <code>$sigma.list</code>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">omega.list</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##           [,1]
## [1,] 0.5728809
## 
## [[2]]
##           [,1]
## [1,] 0.3465021
## 
## [[3]]
##           [,1]
## [1,] 0.1386869
## 
## [[4]]
##           [,1]
## [1,] 0.1570577
## 
## [[5]]
##           [,1]
## [1,] 0.1677731
## 
## [[6]]
##           [,1]
## [1,] 0.3184372</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">sigma.list</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
##             [,1]        [,2]
## [1,] 0.093539238 0.007270049
## [2,] 0.007270049 0.098648424
## 
## [[2]]
##              [,1]         [,2]
## [1,]  0.109020277 -0.004127612
## [2,] -0.004127612  0.087054268
## 
## [[3]]
##            [,1]       [,2]
## [1,] 0.10606530 0.01457913
## [2,] 0.01457913 0.10189653
## 
## [[4]]
##               [,1]          [,2]
## [1,]  0.1025867133 -0.0007429996
## [2,] -0.0007429996  0.0962922149
## 
## [[5]]
##              [,1]         [,2]
## [1,]  0.098080929 -0.006730568
## [2,] -0.006730568  0.112366768
## 
## [[6]]
##           [,1]      [,2]
## [1,] 0.1123437 0.0188019
## [2,] 0.0188019 0.1021367</code></pre>
<p>You can also see the parameter realizations from the <code>$params</code> data frame.</p>
</div>
<div id="simulate-using-variancestandard-deviation-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-using-variancestandard-deviation-standard-errors" class="anchor"></a>Simulate using variance/standard deviation standard errors</h2>
<p>Lets assume we wish to simulate from <a href="https://github.com/UUPharmacometrics/xpose/blob/master/inst/extdata/run001.lst" class="external-link">the nonmem run included in xpose</a></p>
<p>First we setup the model:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rx1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RxODE.html">RxODE</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="va">tcl</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">crcl.cl</span><span class="op">*</span><span class="op">(</span><span class="va">CLCR</span><span class="op">-</span><span class="fl">65</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.v</span><span class="op">)</span>
  <span class="va">v</span> <span class="op">&lt;-</span> <span class="va">tv</span> <span class="op">*</span> <span class="va">WT</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.v</span><span class="op">)</span>
  <span class="va">ka</span> <span class="op">&lt;-</span> <span class="va">tka</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.ka</span><span class="op">)</span>
  <span class="va">ipred</span> <span class="op">&lt;-</span> <span class="fu">linCmt</span><span class="op">(</span><span class="op">)</span>
  <span class="va">obs</span> <span class="op">&lt;-</span> <span class="va">ipred</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">prop.sd</span><span class="op">)</span> <span class="op">+</span> <span class="va">add.sd</span> 
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Next we input the estimated parameters:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>tcl<span class="op">=</span><span class="fl">2.63E+01</span>, tv<span class="op">=</span><span class="fl">1.35E+00</span>, tka<span class="op">=</span><span class="fl">4.20E+00</span>, tlag<span class="op">=</span><span class="fl">2.08E-01</span>,
           prop.sd<span class="op">=</span><span class="fl">2.05E-01</span>, add.sd<span class="op">=</span><span class="fl">1.06E-02</span>, crcl.cl<span class="op">=</span><span class="fl">7.17E-03</span>,
           <span class="co">## Note that since we are using the separation strategy the ETA variances are here too</span>
           eta.cl<span class="op">=</span><span class="fl">7.30E-02</span>,  eta.v<span class="op">=</span><span class="fl">3.80E-02</span>, eta.ka<span class="op">=</span><span class="fl">1.91E+00</span><span class="op">)</span></code></pre></div>
<p>And also their covariances; To me, the easiest way to create a named covariance matrix is to use <code><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri()</a></code>:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">thetaMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri</a></span><span class="op">(</span>
    <span class="va">tcl</span> <span class="op">+</span> <span class="va">tv</span> <span class="op">+</span> <span class="va">tka</span> <span class="op">+</span> <span class="va">tlag</span> <span class="op">+</span> <span class="va">prop.sd</span> <span class="op">+</span> <span class="va">add.sd</span> <span class="op">+</span> <span class="va">crcl.cl</span> <span class="op">+</span> <span class="va">eta.cl</span> <span class="op">+</span> <span class="va">eta.v</span> <span class="op">+</span> <span class="va">eta.ka</span> <span class="op">~</span>
        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7.95E-01</span>,
          <span class="fl">2.05E-02</span>, <span class="fl">1.92E-03</span>,
          <span class="fl">7.22E-02</span>, <span class="op">-</span><span class="fl">8.30E-03</span>, <span class="fl">6.55E-01</span>,
          <span class="op">-</span><span class="fl">3.45E-03</span>, <span class="op">-</span><span class="fl">6.42E-05</span>, <span class="fl">3.22E-03</span>, <span class="fl">2.47E-04</span>,
          <span class="fl">8.71E-04</span>, <span class="fl">2.53E-04</span>, <span class="op">-</span><span class="fl">4.71E-03</span>, <span class="op">-</span><span class="fl">5.79E-05</span>, <span class="fl">5.04E-04</span>,
          <span class="fl">6.30E-04</span>, <span class="op">-</span><span class="fl">3.17E-06</span>, <span class="op">-</span><span class="fl">6.52E-04</span>, <span class="op">-</span><span class="fl">1.53E-05</span>, <span class="op">-</span><span class="fl">3.14E-05</span>, <span class="fl">1.34E-05</span>,
          <span class="op">-</span><span class="fl">3.30E-04</span>, <span class="fl">5.46E-06</span>, <span class="op">-</span><span class="fl">3.15E-04</span>, <span class="fl">2.46E-06</span>, <span class="fl">3.15E-06</span>, <span class="op">-</span><span class="fl">1.58E-06</span>, <span class="fl">2.88E-06</span>,
          <span class="op">-</span><span class="fl">1.29E-03</span>, <span class="op">-</span><span class="fl">7.97E-05</span>, <span class="fl">1.68E-03</span>, <span class="op">-</span><span class="fl">2.75E-05</span>, <span class="op">-</span><span class="fl">8.26E-05</span>, <span class="fl">1.13E-05</span>, <span class="op">-</span><span class="fl">1.66E-06</span>, <span class="fl">1.58E-04</span>,
          <span class="op">-</span><span class="fl">1.23E-03</span>, <span class="op">-</span><span class="fl">1.27E-05</span>, <span class="op">-</span><span class="fl">1.33E-03</span>, <span class="op">-</span><span class="fl">1.47E-05</span>, <span class="op">-</span><span class="fl">1.03E-04</span>, <span class="fl">1.02E-05</span>, <span class="fl">1.67E-06</span>, <span class="fl">6.68E-05</span>, <span class="fl">1.56E-04</span>,
          <span class="fl">7.69E-02</span>, <span class="op">-</span><span class="fl">7.23E-03</span>, <span class="fl">3.74E-01</span>, <span class="fl">1.79E-03</span>, <span class="op">-</span><span class="fl">2.85E-03</span>, <span class="fl">1.18E-05</span>, <span class="op">-</span><span class="fl">2.54E-04</span>, <span class="fl">1.61E-03</span>, <span class="op">-</span><span class="fl">9.03E-04</span>, <span class="fl">3.12E-01</span><span class="op">)</span><span class="op">)</span>

<span class="va">evw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co">## For this problem we will simulate with sampling windows</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span>

<span class="co">## From the run we know that:</span>
<span class="co">##   total number of observations is: 476</span>
<span class="co">##    Total number of individuals:     74</span>
<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">rx1</span>, <span class="va">theta</span>, <span class="va">evw</span>,  nSub<span class="op">=</span><span class="fl">100</span>, nStud<span class="op">=</span><span class="fl">10</span>,
                thetaMat<span class="op">=</span><span class="va">thetaMat</span>,
                <span class="co">## Match boundaries of problem</span>
                thetaLower<span class="op">=</span><span class="fl">0</span>, 
                sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prop.sd"</span>, <span class="st">"add.sd"</span><span class="op">)</span>, <span class="co">## Sigmas are standard deviations</span>
                sigmaXform<span class="op">=</span><span class="st">"identity"</span>, <span class="co"># default sigma xform="identity"</span>
                omega<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eta.cl"</span>, <span class="st">"eta.v"</span>, <span class="st">"eta.ka"</span><span class="op">)</span>, <span class="co">## etas are variances</span>
                omegaXform<span class="op">=</span><span class="st">"variance"</span>, <span class="co"># default omega xform="variance"</span>
                iCov<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">70</span>, <span class="fl">15</span><span class="op">)</span>, CLCR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">65</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>,
                dfSub<span class="op">=</span><span class="fl">74</span>, dfObs<span class="op">=</span><span class="fl">476</span><span class="op">)</span>;

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></code></pre></div>
<pre><code>## ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂ Solved RxODE object ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂
## ── Parameters ($params): ───────────────────────────────────────────────────────
## # A tibble: 10,000 x 10
##    sim.id id      tcl crcl.cl  CLCR    eta.v    tv    WT   tka  eta.ka
##     &lt;int&gt; &lt;fct&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1      1 1      27.0    1.04  54.0  0.907    2.00  71.8  5.69 -0.153 
##  2      1 2      27.0    1.04  19.7 -0.225    2.00  80.2  5.69  0.249 
##  3      1 3      27.0    1.04  45.7  1.66     2.00  66.3  5.69  0.236 
##  4      1 4      27.0    1.04  73.9  0.556    2.00  69.4  5.69 -0.156 
##  5      1 5      27.0    1.04  91.4  0.296    2.00  45.5  5.69 -0.331 
##  6      1 6      27.0    1.04  94.9 -0.680    2.00  35.8  5.69  0.372 
##  7      1 7      27.0    1.04  13.6 -0.327    2.00  95.9  5.69 -0.0760
##  8      1 8      27.0    1.04  66.2  0.589    2.00  57.3  5.69  0.688 
##  9      1 9      27.0    1.04  71.7 -0.611    2.00  41.0  5.69  0.212 
## 10      1 10     27.0    1.04  76.6  0.00250  2.00  66.5  5.69  0.243 
## # … with 9,990 more rows
## ── Initial Conditions ($inits): ────────────────────────────────────────────────
## named numeric(0)
## 
## Simulation with uncertainty in:
## ● parameters (sim$thetaMat for changes)
## ● omega matrix (sim$omegaList)
## ● sigma matrix (sim$sigmaList)
## 
## ── First part of data (object): ────────────────────────────────────────────────
## # A tibble: 50,000 x 8
##   sim.id    id       time    cl     v    ka ipred   obs
##    &lt;int&gt; &lt;int&gt;        [h] &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1      1     1 0.20072222 -696.  356.  4.88    NA    NA
## 2      1     1 0.79938985 -696.  356.  4.88    NA    NA
## 3      1     1 2.50526151 -696.  356.  4.88    NA    NA
## 4      1     1 3.38595486 -696.  356.  4.88    NA    NA
## 5      1     1 9.28579107 -696.  356.  4.88    NA    NA
## 6      1     2 0.04197341 -992.  128.  7.30    NA    NA
## # … with 49,994 more rows
## ▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂</code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Notice that the simulation time-points change for the individual</span>

<span class="co">## If you want the same sampling time-points you can do that as well:</span>
<span class="va">evw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amount.units<span class="op">=</span><span class="st">"mg"</span>, time.units<span class="op">=</span><span class="st">"hours"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>amt<span class="op">=</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">24</span>, length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/et.html">et</a></span><span class="op">(</span>id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>

<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">rx1</span>, <span class="va">theta</span>, <span class="va">evw</span>,  nSub<span class="op">=</span><span class="fl">100</span>, nStud<span class="op">=</span><span class="fl">10</span>,
                thetaMat<span class="op">=</span><span class="va">thetaMat</span>,
                <span class="co">## Match boundaries of problem</span>
                thetaLower<span class="op">=</span><span class="fl">0</span>, 
                sigma<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prop.sd"</span>, <span class="st">"add.sd"</span><span class="op">)</span>, <span class="co">## Sigmas are standard deviations</span>
                sigmaXform<span class="op">=</span><span class="st">"identity"</span>, <span class="co"># default sigma xform="identity"</span>
                omega<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eta.cl"</span>, <span class="st">"eta.v"</span>, <span class="st">"eta.ka"</span><span class="op">)</span>, <span class="co">## etas are variances</span>
                omegaXform<span class="op">=</span><span class="st">"variance"</span>, <span class="co"># default omega xform="variance"</span>
                iCov<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>WT<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">70</span>, <span class="fl">15</span><span class="op">)</span>, CLCR<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">65</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>,
                dfSub<span class="op">=</span><span class="fl">74</span>, dfObs<span class="op">=</span><span class="fl">476</span><span class="op">)</span>

<span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ipred"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarizing data...done</code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div id="simulate-without-uncertainty-in-omega-or-sigma-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#simulate-without-uncertainty-in-omega-or-sigma-parameters" class="anchor"></a>Simulate without uncertainty in <code>omega</code> or <code>sigma</code> parameters</h2>
<p>If you do not wish to sample from the prior distributions of either the <code>omega</code> or <code>sigma</code> matrices, you can turn off this feature by specifying the <code>simVariability = FALSE</code> option when solving:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RxODE.html">RxODE</a></span><span class="op">(</span><span class="op">{</span>
  <span class="fu">eff</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">=</span> <span class="fl">1</span>
  <span class="va">C2</span> <span class="op">=</span> <span class="va">centr</span><span class="op">/</span><span class="va">V2</span>;
  <span class="va">C3</span> <span class="op">=</span> <span class="va">peri</span><span class="op">/</span><span class="va">V3</span>;
  <span class="va">CL</span> <span class="op">=</span>  <span class="va">TCl</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta.Cl</span><span class="op">)</span> <span class="co">## This is coded as a variable in the model</span>
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">depot</span><span class="op">)</span> <span class="op">=</span><span class="op">-</span><span class="va">KA</span><span class="op">*</span><span class="va">depot</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">centr</span><span class="op">)</span> <span class="op">=</span> <span class="va">KA</span><span class="op">*</span><span class="va">depot</span> <span class="op">-</span> <span class="va">CL</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">+</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">peri</span><span class="op">)</span>  <span class="op">=</span>                    <span class="va">Q</span><span class="op">*</span><span class="va">C2</span> <span class="op">-</span> <span class="va">Q</span><span class="op">*</span><span class="va">C3</span>;
  <span class="va">d</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">eff</span><span class="op">)</span>  <span class="op">=</span> <span class="va">Kin</span> <span class="op">-</span> <span class="va">Kout</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">C2</span><span class="op">/</span><span class="op">(</span><span class="va">EC50</span><span class="op">+</span><span class="va">C2</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">eff</span>;
  <span class="va">e</span> <span class="op">=</span> <span class="va">eff</span><span class="op">+</span><span class="va">eff.err</span>
  <span class="va">cp</span> <span class="op">=</span> <span class="va">centr</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="va">cp.err</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>KA<span class="op">=</span><span class="fl">2.94E-01</span>, TCl<span class="op">=</span><span class="fl">1.86E+01</span>, V2<span class="op">=</span><span class="fl">4.02E+01</span>,  <span class="co"># central </span>
           Q<span class="op">=</span><span class="fl">1.05E+01</span>, V3<span class="op">=</span><span class="fl">2.97E+02</span>,                <span class="co"># peripheral</span>
           Kin<span class="op">=</span><span class="fl">1</span>, Kout<span class="op">=</span><span class="fl">1</span>, EC50<span class="op">=</span><span class="fl">200</span><span class="op">)</span>                <span class="co"># effects  </span>

<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lotri/man/lotri.html" class="external-link">lotri</a></span><span class="op">(</span><span class="va">eff.err</span> <span class="op">~</span> <span class="fl">0.1</span>, <span class="va">cp.err</span> <span class="op">~</span> <span class="fl">0.1</span><span class="op">)</span>


<span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">theta</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span>, nSub<span class="op">=</span><span class="fl">100</span>, sigma<span class="op">=</span><span class="va">sigma</span>,
                thetaMat<span class="op">=</span><span class="va">tMat</span>, nStud<span class="op">=</span><span class="fl">10</span>,
                simVariability<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centr"</span>, <span class="st">"eff"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarizing data...done</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></code></pre></div>
<p><img src="sim-var_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Note since realizations of <code>omega</code> and <code>sigma</code> were not simulated, <code>$omega.list</code> and <code>$sigma.list</code> both return <code>NULL</code>.</p>
<div id="rxode-multi-threaded-solving-and-simulation" class="section level4">
<h4 class="hasAnchor">
<a href="#rxode-multi-threaded-solving-and-simulation" class="anchor"></a>RxODE multi-threaded solving and simulation</h4>
<p>RxODE now supports multi-threaded solving on OpenMP supported compilers, including linux and windows. Mac OSX can also be supported By default it uses all your available cores for solving as determined by <code><a href="../reference/getRxThreads.html">rxCores()</a></code>. This may be overkill depending on your system, at a certain point the speed of solving is limited by things other than computing power.</p>
<p>You can also speed up simulation by using the multi-cores to generate random deviates with <code>mvnfast</code> (either <code>mvnfast::rmvn()</code> or <code>mvnfast::rmvt()</code>). This is controlled by the <code>nCoresRV</code> parameter. For example:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rxSolve.html">rxSolve</a></span><span class="op">(</span><span class="va">mod</span>, <span class="va">theta</span>, <span class="va">ev</span>, omega<span class="op">=</span><span class="va">omega</span>, nSub<span class="op">=</span><span class="fl">100</span>, sigma<span class="op">=</span><span class="va">sigma</span>, thetaMat<span class="op">=</span><span class="va">tMat</span>, nStud<span class="op">=</span><span class="fl">10</span>,
                nCoresRV<span class="op">=</span><span class="fl">2</span><span class="op">)</span>;

<span class="va">s</span> <span class="op">&lt;-</span><span class="va">sim</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eff"</span>, <span class="st">"centr"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## summarizing data...done</code></pre>
<p>The default for this is <code>1</code> core since the result depends on the number of cores and the random seed you use in your simulation as well as the work-load each thread is sharing/architecture. However, you can always speed up this process with more cores if you are sure your collaborators have the same number of cores available to them and have OpenMP thread-capable compile.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Matthew L. Fidler, Melissa Hallow, Wenping Wang.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '038b4d83946a52a95a9f8bdafe822dbe',
    indexName: 'rxode',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
